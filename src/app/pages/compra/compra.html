
  <!-- FORMULARIO REACTIVO -->
  <form [formGroup]="formularioCompra" (ngSubmit)="finalizarCompra()" class="mx-auto" style="max-width:600px;">

    <h4 class="mb-3 text-center">Datos del Comprador</h4>

    <div class="row g-3 mb-3">

      <!-- NOMBRE -->
      <div class="col-md-6">
        <label class="form-label fw-semibold">Nombre <span class="text-danger">*</span></label>
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-person-fill"></i></span>
          <input formControlName="nombre" class="form-control" placeholder="Tu Nombre Completo">
        </div>
        <div *ngIf="formularioCompra.get('nombre')?.touched && formularioCompra.get('nombre')?.invalid"
             class="form-text text-danger">
          El nombre es obligatorio.
        </div>
      </div>

      <!-- TELEFONO -->
      <div class="col-md-6">
        <label class="form-label fw-semibold">Telefono <span class="text-danger">*</span></label>
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-telephone-fill"></i></span>
          <input formControlName="telefono" class="form-control" placeholder="Ej: +54 9 11 1234 5678">
        </div>
        <div *ngIf="formularioCompra.get('telefono')?.touched && formularioCompra.get('telefono')?.invalid"
             class="form-text text-danger">
          El teléfono es obligatorio.
        </div>
      </div>

      <!-- CORREO -->
      <div class="mb-3">
        <label class="form-label fw-semibold">Correo Electrónico <span class="text-danger">*</span></label>
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-envelope-fill"></i></span>
          <input formControlName="correo" type="email" class="form-control" placeholder="correo@ejemplo.com">
        </div>
        <div *ngIf="formularioCompra.get('correo')?.touched && formularioCompra.get('correo')?.invalid"
             class="form-text text-danger">
          El correo es obligatorio.
        </div>
      </div>

      <!-- DIRECCIÓN -->
      <div class="mb-3">
        <label class="form-label fw-semibold">Dirección <span class="text-danger">*</span></label>
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-geo-alt-fill"></i></span>
          <input formControlName="direccion" class="form-control" placeholder="Calle, número, piso…">
        </div>
        <div *ngIf="formularioCompra.get('direccion')?.touched && formularioCompra.get('direccion')?.invalid"
             class="form-text text-danger">
          La dirección es obligatoria.
        </div>
      </div>

      <!-- CIUDAD / PROVINCIA / CP -->
      <div class="row g-3 mb-3">

        <div class="col-md-4">
          <label class="form-label fw-semibold">Ciudad <span class="text-danger">*</span></label>
          <input formControlName="ciudad" class="form-control" placeholder="Ej: Buenos Aires">
        </div>

        <div class="col-md-4">
          <label class="form-label fw-semibold">Provincia <span class="text-danger">*</span></label>
          <input formControlName="provincia" class="form-control" placeholder="Ej: Buenos Aires">
        </div>

        <div class="col-md-4">
          <label class="form-label fw-semibold">Código Postal <span class="text-danger">*</span></label>
          <input formControlName="codigopostal" class="form-control" placeholder="Ej: 1428">
        </div>

      </div>

      <!-- METODO DE PAGO -->
      <div class="mb-3">
        <label class="form-label fw-semibold">Método de Pago <span class="text-danger">*</span></label>
        <select formControlName="metodoPago" class="form-select">
          <option value="" disabled selected>Seleccione método de pago</option>
          <option value="efectivo">Efectivo</option>
          <option value="transferencia">Transferencia</option>
        </select>
      </div>

      <!-- BOTON -->
      <div class="d-flex justify-content-between align-items-center my-4">
        <div>
          <p style="color: white;">Envío: ${{ envio.toFixed(2) }}</p>
          <p style="color: white;"><strong>Total a pagar: ${{ calcularTotal() | number:'1.2-2' }}</strong></p>
        </div>

        <button type="submit" class="btn btn-primary" [disabled]="cargando">
          {{ cargando ? 'Procesando...' : 'Finalizar Compra' }}
        </button>
      </div>

    </div>
  </form>

  <!-- CARRITO VACÍO -->
  <div *ngIf="productos.length === 0" class="alert alert-warning text-center">
    Tu carrito está vacío.
  </div>



<!-- MODAL PDF -->
<div *ngIf="mostrarModal" class="modal show d-block" style="background: rgba(0,0,0,.5);">
  <div class="modal-dialog modal-xl">
    <div class="modal-content" style="height: 90vh;">

      <div class="modal-header">
        <h5 class="modal-title">Factura PDF</h5>
        <button class="btn-close" (click)="cerrarModal()"></button>
      </div>

      <div class="modal-body p-0" style="height:80vh;">
        <iframe *ngIf="pdfSrc" [src]="pdfSrc" style="width:100%; height:100%; border:none;"></iframe>
      </div>

      <div class="modal-footer">
        <button class="btn btn-success" (click)="imprimirPDF()">Imprimir</button>
        <button class="btn btn-secondary" (click)="cerrarModal()">Cerrar</button>
      </div>

    </div>
  </div>
</div>
